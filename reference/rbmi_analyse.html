<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Analyse Multiple Imputed Datasets — rbmi_analyse • junco</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyse Multiple Imputed Datasets — rbmi_analyse"><meta name="description" content="This function takes multiple imputed datasets (as generated by
the rbmi::impute() function) and runs an analysis function on
each of them."><meta property="og:description" content="This function takes multiple imputed datasets (as generated by
the rbmi::impute() function) and runs an analysis function on
each of them."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">junco</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/johnsonandjohnson/junco/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analyse Multiple Imputed Datasets</h1>
      <small class="dont-index">Source: <a href="https://github.com/johnsonandjohnson/junco/blob/main/R/rbmi.R" class="external-link"><code>R/rbmi.R</code></a></small>
      <div class="d-none name"><code>rbmi_analyse.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function takes multiple imputed datasets (as generated by
the <code><a href="https://insightsengineering.github.io/rbmi/reference/impute.html" class="external-link">rbmi::impute()</a></code> function) and runs an analysis function on
each of them.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rbmi_analyse</span><span class="op">(</span></span>
<span>  <span class="va">imputations</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">rbmi_ancova</span>,</span>
<span>  delta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  cluster_or_cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  .validate <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-imputations">imputations<a class="anchor" aria-label="anchor" href="#arg-imputations"></a></dt>
<dd><p>An <code>imputations</code> object as created by <code><a href="https://insightsengineering.github.io/rbmi/reference/impute.html" class="external-link">rbmi::impute()</a></code>.</p></dd>


<dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>An analysis function to be applied to each imputed dataset. See details.</p></dd>


<dt id="arg-delta">delta<a class="anchor" aria-label="anchor" href="#arg-delta"></a></dt>
<dd><p>A <code>data.frame</code> containing the delta transformation to be applied to the imputed
datasets prior to running <code>fun</code>. See details.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed onto <code>fun</code>.</p></dd>


<dt id="arg-cluster-or-cores">cluster_or_cores<a class="anchor" aria-label="anchor" href="#arg-cluster-or-cores"></a></dt>
<dd><p>The number of parallel processes to use when running this function. Can also be a
cluster object created by <code><a href="make_rbmi_cluster.html">make_rbmi_cluster()</a></code>. See the parallelisation section below.</p></dd>


<dt id="arg--validate">.validate<a class="anchor" aria-label="anchor" href="#arg--validate"></a></dt>
<dd><p>Should <code>imputations</code> be checked to ensure it conforms to the required format
(default = <code>TRUE</code>) ? Can gain a small performance increase if this is set to <code>FALSE</code> when
analysing a large number of samples.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>analysis</code> object, as defined by <code>rbmi</code>, representing the desired
analysis applied to each of the imputed datasets in <code>imputations</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function works by performing the following steps:</p><ol><li><p>Extract a dataset from the <code>imputations</code> object.</p></li>
<li><p>Apply any delta adjustments as specified by the <code>delta</code> argument.</p></li>
<li><p>Run the analysis function <code>fun</code> on the dataset.</p></li>
<li><p>Repeat steps 1-3 across all of the datasets inside the <code>imputations</code>
object.</p></li>
<li><p>Collect and return all of the analysis results.</p></li>
</ol><p>The analysis function <code>fun</code> must take a <code>data.frame</code> as its first
argument. All other options to <code>rbmi_analyse()</code> are passed onto <code>fun</code>
via <code>...</code>.
<code>fun</code> must return a named list with each element itself being a
list containing a single
numeric element called <code>est</code> (or additionally <code>se</code> and <code>df</code> if
you had originally specified <code><a href="https://insightsengineering.github.io/rbmi/reference/method.html" class="external-link">rbmi::method_bayes()</a></code> or <code><a href="https://insightsengineering.github.io/rbmi/reference/method.html" class="external-link">rbmi::method_approxbayes()</a></code>)
i.e.:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">myfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mod_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>, <span class="va">outcome</span> <span class="op">~</span> <span class="va">group</span><span class="op">)</span></span>
<span>    <span class="va">mod_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>, <span class="va">outcome</span> <span class="op">~</span> <span class="va">group</span> <span class="op">+</span> <span class="va">covar</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        trt_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod_1</span><span class="op">)</span><span class="op">[[</span><span class="st">'group'</span><span class="op">]</span><span class="op">]</span>,  <span class="co"># Use [[ ]] for safety</span></span>
<span>            se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mod_1</span><span class="op">)</span><span class="op">[</span><span class="st">'group'</span>, <span class="st">'group'</span><span class="op">]</span><span class="op">)</span>, <span class="co"># Use ['','']</span></span>
<span>            df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html" class="external-link">df.residual</a></span><span class="op">(</span><span class="va">mod_1</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        trt_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod_2</span><span class="op">)</span><span class="op">[[</span><span class="st">'group'</span><span class="op">]</span><span class="op">]</span>,  <span class="co"># Use [[ ]] for safety</span></span>
<span>            se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mod_2</span><span class="op">)</span><span class="op">[</span><span class="st">'group'</span>, <span class="st">'group'</span><span class="op">]</span><span class="op">)</span>, <span class="co"># Use ['','']</span></span>
<span>            df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html" class="external-link">df.residual</a></span><span class="op">(</span><span class="va">mod_2</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>     <span class="op">)</span></span>
<span>     <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span> <span class="op">}</span></span></code></pre></div>

<p>Please note that the <code>vars$subjid</code> column (as defined in the original call to
<code><a href="https://insightsengineering.github.io/rbmi/reference/draws.html" class="external-link">rbmi::draws()</a></code>) will be scrambled in the data.frames that are provided to <code>fun</code>.
This is to say they will not contain the original subject values and as such
any hard coding of subject ids is strictly to be avoided.</p>
<p>By default <code>fun</code> is the <code><a href="rbmi_ancova.html">rbmi_ancova()</a></code> function.
Please note that this function
requires that a <code>vars</code> object, as created by <code><a href="https://insightsengineering.github.io/rbmi/reference/set_vars.html" class="external-link">rbmi::set_vars()</a></code>, is provided via
the <code>vars</code> argument e.g. <code>rbmi_analyse(imputeObj, vars = rbmi::set_vars(...))</code>. Please
see the documentation for <code><a href="rbmi_ancova.html">rbmi_ancova()</a></code> for full details.
Please also note that the theoretical justification for the conditional mean imputation
method (<code>method = method_condmean()</code> in <code><a href="https://insightsengineering.github.io/rbmi/reference/draws.html" class="external-link">rbmi::draws()</a></code>) relies on the fact that ANCOVA is
a linear transformation of the outcomes.
Thus care is required when applying alternative analysis functions in this setting.</p>
<p>The <code>delta</code> argument can be used to specify offsets to be applied
to the outcome variable in the imputed datasets prior to the analysis.
This is typically used for sensitivity or tipping point analyses. The
delta dataset must contain columns <code>vars$subjid</code>, <code>vars$visit</code> (as specified
in the original call to <code><a href="https://insightsengineering.github.io/rbmi/reference/draws.html" class="external-link">rbmi::draws()</a></code>) and <code>delta</code>. Essentially this <code>data.frame</code>
is merged onto the imputed dataset by <code>vars$subjid</code> and <code>vars$visit</code> and then
the outcome variable is modified by:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>imputed_data[[vars<span class="sc">$</span>outcome]] <span class="ot">&lt;-</span> imputed_data[[vars<span class="sc">$</span>outcome]] <span class="sc">+</span> imputed_data[[<span class="st">'delta'</span>]]</span></code></pre><p></p></div>
<p>Please note that in order to provide maximum flexibility, the <code>delta</code> argument
can be used to modify any/all outcome values including those that were not
imputed. Care must be taken when defining offsets. It is recommend that you
use the helper function <code><a href="https://insightsengineering.github.io/rbmi/reference/delta_template.html" class="external-link">rbmi::delta_template()</a></code> to define the delta datasets as
this provides utility variables such as <code>is_missing</code> which can be used to identify
exactly which visits have been imputed.</p>
    </div>
    <div class="section level2">
    <h2 id="parallelisation">Parallelisation<a class="anchor" aria-label="anchor" href="#parallelisation"></a></h2>


<p>To speed up the evaluation of <code>rbmi_analyse()</code> you can use the <code>cluster_or_cores</code> argument to enable parallelisation.
Simply providing an integer will get <code>rbmi</code> to automatically spawn that many background processes
to parallelise across. If you are using a custom analysis function then you need to ensure
that any libraries or global objects required by your function are available in the
sub-processes. To do this you need to use the <code><a href="make_rbmi_cluster.html">make_rbmi_cluster()</a></code> function for example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>my_custom_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(...) <span class="sc">&lt;</span>some analysis code<span class="sc">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">make_rbmi_cluster</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="dv">4</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="at">objects =</span> <span class="fu">list</span>(<span class="st">'my_custom_fun'</span> <span class="ot">=</span> my_custom_fun),</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">'dplyr'</span>, <span class="st">'nlme'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">rbmi_analyse</span>(</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="at">imputations =</span> imputeObj,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="at">fun =</span> my_custom_fun,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    <span class="at">cluster_or_cores =</span> cl</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">stopCluster</span>(cl)</span></code></pre><p></p></div>
<p>Note that there is significant overhead both with setting up the sub-processes and with
transferring data back-and-forth between the main process and the sub-processes. As such
parallelisation of the <code>rbmi_analyse()</code> function tends to only be worth it when you have
<code>&gt; 2000</code> samples generated by <code><a href="https://insightsengineering.github.io/rbmi/reference/draws.html" class="external-link">rbmi::draws()</a></code>. Conversely using parallelisation if your samples
are smaller than this may lead to longer run times than just running it sequentially.</p>
<p>It is important to note that the implementation of parallel processing within [rbmi::analyse()<code>] has been optimised around the assumption that the parallel processes will be spawned on the same machine and not a remote cluster. One such optimisation is that the required data is saved to a temporary file on the local disk from which it is then read into each sub-process. This is done to avoid the overhead of transferring the data over the network. Our assumption is that if you are at the stage where you need to be parallelising your analysis over a remote cluster then you would likely be better off parallelising across multiple </code>rbmi<code>runs rather than within a single</code>rbmi` run.</p>
<p>Finally, if you are doing a tipping point analysis you can get a reasonable performance
improvement by re-using the cluster between each call to <code>rbmi_analyse()</code> e.g.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">make_rbmi_cluster</span>(<span class="dv">4</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>ana_1 <span class="ot">&lt;-</span> <span class="fu">rbmi_analyse</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="at">imputations =</span> imputeObj,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="at">delta =</span> delta_plan_1,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    <span class="at">cluster_or_cores =</span> cl</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>ana_2 <span class="ot">&lt;-</span> <span class="fu">rbmi_analyse</span>(</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="at">imputations =</span> imputeObj,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="at">delta =</span> delta_plan_2,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    <span class="at">cluster_or_cores =</span> cl</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>ana_3 <span class="ot">&lt;-</span> <span class="fu">rbmi_analyse</span>(</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>    <span class="at">imputations =</span> imputeObj,</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    <span class="at">delta =</span> delta_plan_3,</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    <span class="at">cluster_or_cores =</span> cl</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">clusterStop</span>(cl)</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://insightsengineering.github.io/rbmi/reference/extract_imputed_dfs.html" class="external-link">rbmi::extract_imputed_dfs()</a></code> for manually extracting imputed
datasets.</p>
<p><code><a href="https://insightsengineering.github.io/rbmi/reference/delta_template.html" class="external-link">rbmi::delta_template()</a></code> for creating delta data.frames.</p>
<p><code><a href="rbmi_ancova.html">rbmi_ancova()</a></code> for the default analysis function.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/rbmi/" class="external-link">rbmi</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘rbmi’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:junco’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     make_rbmi_cluster</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">antidepressant_data</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">GENDER</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">GENDER</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">POOLINV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">POOLINV</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pat_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">PATIENT</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nlevels.html" class="external-link">nlevels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">PATIENT</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">PATIENT</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">pat_ids</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/expand.html" class="external-link">expand_locf</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dat</span>,</span></span>
<span class="r-in"><span>  PATIENT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">PATIENT</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  VISIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">VISIT</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span>, <span class="st">"THERAPY"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PATIENT"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PATIENT"</span>, <span class="st">"VISIT"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CHANGE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PATIENT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="st">"JR"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat_ice</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat_ice</span><span class="op">$</span><span class="va">PATIENT</span> <span class="op">==</span> <span class="fl">3618</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/set_vars.html" class="external-link">set_vars</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="st">"CHANGE"</span>,</span></span>
<span class="r-in"><span>  visit <span class="op">=</span> <span class="st">"VISIT"</span>,</span></span>
<span class="r-in"><span>  subjid <span class="op">=</span> <span class="st">"PATIENT"</span>,</span></span>
<span class="r-in"><span>  group <span class="op">=</span> <span class="st">"THERAPY"</span>,</span></span>
<span class="r-in"><span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"THERAPY"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">drawObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/draws.html" class="external-link">draws</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>  data_ice <span class="op">=</span> <span class="va">dat_ice</span>,</span></span>
<span class="r-in"><span>  vars <span class="op">=</span> <span class="va">vars</span>,</span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/method.html" class="external-link">method_condmean</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"jackknife"</span>, covariance <span class="op">=</span> <span class="st">"csh"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">references</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DRUG"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span>, <span class="st">"PLACEBO"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">imputeObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/impute.html" class="external-link">impute</a></span><span class="op">(</span><span class="va">drawObj</span>, <span class="va">references</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">rbmi_analyse</span><span class="op">(</span>imputations <span class="op">=</span> <span class="va">imputeObj</span>, vars <span class="op">=</span> <span class="va">vars</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Analysis Object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Results: 1 + 43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Analysis Function: rbmi_ancova</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Delta Applied: FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Analysis Estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     var_4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     trt_PLACEBO_4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lsm_DRUG_4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lsm_PLACEBO_4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     var_5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     trt_PLACEBO_5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lsm_DRUG_5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lsm_PLACEBO_5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     var_6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     trt_PLACEBO_6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lsm_DRUG_6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lsm_PLACEBO_6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     var_7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     trt_PLACEBO_7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lsm_DRUG_7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lsm_PLACEBO_7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gabriel Becker, Ilse Augustyns, Paul Jenkins, Daniel Hofstaedter, Joseph Kovach, David Munoz Tord, Daniel Sabanes Bove, Ezequiel Anokian, Renfei Mao, Mrinal Das, Johnson &amp; Johnson Innovative Medicine.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

